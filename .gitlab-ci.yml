stages:
  - lint
  - test


lint-frontend:
  stage: lint
  before_script:
    - npm install
    - npm i -D eslint
  script:
    - cd ./frontend
    - mkdir -p frontend-lint-report
    - npm run lint > ./frontend-lint-report/lint-report.txt
  artifacts:
    reports:
      frontend-lint: frontend-lint-report/lint-report.txt
    expire_in: 1 month
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event" || $CI_COMMIT_BRANCH == "main"

lint-backend:
  stage: lint
  before_script:
    - gem install rubocop
  script:
    - cd ./backend
    - bundle install
    - mkdir -p backend-lint-report
    - rubocop --format txt --out ./backend-lint-report/lint-report.txt
  artifacts:
    reports:
      backend-lint: backend-lint-report/lint-report.txt
    expire_in: 1 month
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event" || $CI_COMMIT_BRANCH == "main"

unit-tests:
  stage: test
  script:
    - cd ./backend
    - npm run test
  artifacts:
    reports:
      unit-test-report: ./backend/test/controllers/contacts_controller_test.rb
    expire_in: 1 month
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event" || $CI_COMMIT_BRANCH == "main"